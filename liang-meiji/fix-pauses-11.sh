#!/bin/bash
# 修复11-胜海舟TTS文本的断句和停顿问题

FILE="articles/11-胜海舟-tts.txt"
BACKUP="$FILE.pause-fix-backup"

if [ ! -f "$FILE" ]; then
  echo "❌ 文件不存在: $FILE"
  exit 1
fi

# 备份
cp "$FILE" "$BACKUP"
echo "💾 原文备份: $BACKUP"

echo "🔧 修复断句和停顿问题..."

# 1. 数字+量词分隔（高频）
sed -i '' \
  -e 's/一百五十万人/一百五十万、人/g' \
  -e 's/六十个水手/六十、个水手/g' \
  -e 's/三个人病死/三、个人病死/g' \
  -e 's/两个月/两、个月/g' \
  -e 's/两天/两、天/g' \
  -e 's/四个字/四、个字/g' \
  -e 's/一万多人/一万、多人/g' \
  -e 's/五千人/五千、人/g' \
  -e 's/三十多年/三十、多年/g' \
  "$FILE"

# 2. 列举项之间加强停顿（省略号后补逗号）
sed -i '' \
  -e 's/报纸……一个完全/报纸……，一个完全/g' \
  "$FILE"

# 3. "大意是"后面统一用破折号+空格（模拟停顿）
sed -i '' \
  -e 's/大意是：/大意是——/g' \
  "$FILE"

# 4. 超长引语拆分（54字以上的引语内部加句号）
# 问题句："他对西乡说——你攻进来当然可以，但你想过没有，这座城里有一百五十万人..."
sed -i '' \
  -e 's/但你想过没有，这座城里/但你想过没有？这座城里/g' \
  -e 's/江户变成焦土，新政府/江户变成焦土。新政府/g' \
  "$FILE"

# 5. "说了一句话"后的引语内部拆分
# 问题句："说了一句话——和、胜海舟、初次见面，确实吓了一跳，这个人的见识深不可测。"
sed -i '' \
  -e 's/确实吓了一跳，这个人的见识/确实吓了一跳。这个人的见识/g' \
  "$FILE"

# 6. 长句拆分：两个独立陈述句用句号分隔（不用逗号）
sed -i '' \
  -e 's/咸临丸是一艘荷兰造的军舰，日本人从来/咸临丸是一艘荷兰造的军舰。日本人从来/g' \
  "$FILE"

# 7. "到此结束"加强停顿（遗言，需要庄重感）
sed -i '' \
  -e 's/"到此结束。"/"到此结束……"/g' \
  "$FILE"

echo "✅ 修复完成！"
echo ""
echo "修复项统计："
echo "• 数字量词分隔: 9处"
echo "• 列举项停顿: 1处"
echo "• 引语标记统一: 1处"
echo "• 超长句拆分: 4处"
echo ""
echo "对比验证："
echo "原文: $BACKUP"
echo "新文: $FILE"
